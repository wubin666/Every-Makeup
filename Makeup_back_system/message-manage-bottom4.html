<!DOCTYPE html >
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="http://g.alicdn.com/bui/bui/1.1.21/css/bs3/dpl.css" rel="stylesheet">
    <link href="http://g.alicdn.com/bui/bui/1.1.21/css/bs3/bui.css" rel="stylesheet">
    <style>
      .bui-grid-hd-inner{
        text-align: center;
      }
      .bui-grid-table .bui-grid-hd-title{
        padding: 0px;
      }
      .demo-content{
        margin-left:180px;
      }
    </style>
    <title>Document</title>
</head>
<body >
    <div class="demo-content" name="manage_frame">
        <div class="row">
            <div class="span16">
                <div id="grid">
                      
                </div>
            </div>
        </div>
    </div>            
</body>
</html>
<script src="http://g.tbcdn.cn/fi/bui/jquery-1.8.1.min.js"></script>
<script src="http://g.alicdn.com/bui/seajs/2.3.0/sea.js"></script>
<script src="http://g.alicdn.com/bui/bui/1.1.21/config.js"></script>

<script type="text/javascript">
    BUI.use(['bui/grid','bui/data'],function(Grid,Data){
        var 
      Store = Data.Store,
      enumObj = {"1" : "选项一","2" : "选项二","3" : "选项三"},
      columns = [
        {title : '收藏人每妆号',dataIndex :'a',editor : {xtype : 'number',validator : validFn}}, //editor中的定义等用于 BUI.Form.Field.Text的定义
        {title : '昵称', dataIndex :'b',editor : {xtype : 'text',rules : {required : true}}},
        {title : '被收藏人每妆号', dataIndex :'c',editor : {xtype : 'number',rules : {required : true}}},
        {title : '昵称',dataIndex :'d', editor : {xtype : 'text'},renderer : Grid.Format.dateRenderer},
        {title : '被收藏作品编号',dataIndex :'e',editor : {xtype : 'number',validator : validFn}},
        {title : '收藏时间',dataIndex :'f',editor : {xtype : 'date',validator : validFn}},
        {title : '操作',dataIndex : 'g',editor : {xtype : 'text',validator : validFn}}


      ],
      data = [{a:'20183223',b:'sunshine',c:'20185423',d:'小鱼儿',e:'50012',f:'2018-05-12',g:'✎编辑'},{a:'20183545',b:'如果能...',c:'20186845',d:'晴宝二',e:'50014',f:'2018-03-12',g:'✎编辑'},{a:'20184755',b:'回忆',c:'20188722',d:'hello',e:'50019',f:'2018-05-18',g:'✎编辑'},{a:'20186478',b:'NET',c:'20184299',d:'静待佳音',e:'50025',f:'2018-02-12',g:'✎编辑'}]
    function valid(value){
      if(value === '1'){
        return '不能选择1';
      }
    }
    var editing = new Grid.Plugins.CellEditing({
      triggerSelected : false //触发编辑的时候不选中行
    }),
      store = new Store({
        data : data,
        autoLoad:true
      }),
      grid = new Grid.Grid({
        render:'#grid',
        columns : columns,
        width : 700,
        forceFit : true,
        tbar:{ //添加、删除
            items : [{
              btnCls : 'button button-small',
              text : '<i class="icon-plus"></i>添加',
              listeners : {
                'click' : addFunction
              }
            },
            {
              btnCls : 'button button-small',
              text : '<i class="icon-remove"></i>删除',
              listeners : {
                'click' : delFunction
              }
            }]
        },
        plugins : [editing,Grid.Plugins.CheckSelection,Grid.Plugins.ColumnChecked],
        store : store
      });

    grid.render();

    

    function validFn (value,obj) {
      var records = store.getResult(),
        rst = '';
      BUI.each(records,function (record) {
        if(record.a == value && obj != record){
          rst = '文本不能重复';
          return false;
        }
      });
      return rst;
    }

    //添加记录
    function addFunction(){
      var newData = {b : 0};
      store.addAt(newData,0);
      editing.edit(newData,'a'); //添加记录后，直接编辑
    }
    //删除选中的记录
    function delFunction(){
      var selections = grid.getSelection();
      store.remove(selections);
    }          
  });
</script>